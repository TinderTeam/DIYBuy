<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Expires" content="Fri, Jan 01 1900 00:00:00 GMT">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Cache-Control" content="no-cache">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="Lang" content="en">
<meta http-equiv="Reply-to" content="@.com">
<meta name="generator" content="PhpED 8.0">
<meta name="description" content="">
<meta name="keywords" content="">
<meta name="creation-date" content="09/06/2012">
<meta name="revisit-after" content="15 days">
<title>DIY团购网站后台管理系统</title>
	<link rel="stylesheet" href="__PUBLIC__/css/bootstrap.css" type="text/css"/> 
	<link href="__PUBLIC__/ueditor/themes/default/css/umeditor.css" type="text/css" rel="stylesheet">
	
	
	<script src="__PUBLIC__/js/jquery-1.9.1.min.js" type="text/javascript"></script>
	<script src="__PUBLIC__/js/My97DatePicker/WdatePicker.js" type="text/javascript"></script>
	<script src="__PUBLIC__/js/uploadPreview.min.js"></script>
	<script type="text/javascript" charset="utf-8" src="__PUBLIC__/ueditor/umeditor.config.js"></script>
    <script type="text/javascript" charset="utf-8" src="__PUBLIC__/ueditor/umeditor.min.js"> </script>
    <!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
	<!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
    <script type="text/javascript" charset="utf-8" src="__PUBLIC__/ueditor/lang/zh-cn/zh-cn.js"></script>
	<script>
        $(function () {
            $("#up0").uploadPreview({ Img: "img0"});
        });
    </script>
	
 
</head>
<body> 

<hr/>
<div id="Container">  <!--页面容器--> 
    <div class="row">
		<div class="col-xs-1"></div>
		<div class="col-xs-6">
		<h3 style="margin-top: 5px;">新建团购产品</h3>
		</div>        
	</div>
    
    <div class="row">
        <div class="col-xs-1"></div>
        <div class="col-xs-10">

            <hr/>
            
        <form id="form" action="__APP__/ProductManage/addChk" method="POST" enctype="multipart/form-data">
            <div class="row">
                <div class="col-xs-12">
					<div class="panel panel-primary"> 
						<div class="panel-heading">
							<div class="row">
								<div class="col-xs-11" style="float: left; padding-top: 5px;">
									<span style="">新建产品</span>
								</div> 
								<div class="col-xs-1" style="float: left;">
									<button type="button" class="btn-sm btn-default submit-btn">提交</button>
									<!--- <button type="submit" class="btn-sm btn-default">提交</button>--->
								</div> 
							</div>
						</div>

                  <!-- Table -->
					<table class="table">
						<tr>
							<td style=" text-align: center;">产品标题</td>
							<td style=" text-align: center;">团购人数</td>
							<td style=" text-align: center;">原价</td>
							<td style=" text-align: center;">团购价</td>
						</tr>
						<tr>
							<td style=" text-align: center;">
								<input name="name" maxlength="15" type="text" class="form-control" placeholder="产品标题最多15个字"/>
							</td>
							<td style=" text-align: center;">
								<input name="total_num" type="text" class="form-control" placeholder="请输入可参团总人数"/>
							</td>
							<td style=" text-align: center;">
								<input name="price_original" type="text" class="form-control" placeholder="请输入产品原价"/>
							</td>
							<td style=" text-align: center;">
								<input name="price_high" type="text" class="form-control" placeholder="请输入用团购价"/>
							</td>
						</tr>
						<tr>
							<td style=" text-align: center;">优惠券价格</td>
							<td style=" text-align: center;">到期时间</td>
							<td style=" text-align: center;">产品链接</td>
							<td style=" text-align: center;"></td>
						</tr>
						<tr>
							<td style=" text-align: center;">
								<input name="price_low" type="text" class="form-control" placeholder="请输入代金券价格￥"/>
							</td>
							<td style=" text-align: center;">
								<input id="userName"  type="text" class="form-control" data-date="" data-date-format="yyyy-mm-dd" value="2014-01-01" onFocus="WdatePicker()" name="time_end" />
								<!---
								<input name="time_end" type="text" class="form-control" id="userName" placeholder="到期时间(XXXX-XX-XX)"/>
								--->
								<input name="status" type="text" class="form-control" value="团购中" style="display:none;"/>
							</td>
							<td style=" text-align: center;">
								<input name="link_add" type="text" class="form-control" placeholder="请输入产品原价"/>
							</td>
							<td style=" text-align: center;">
							</td>
						</tr>
					</table>
						<div class="panel-body">
							<p>
							<table class="table">
								<tr><td>宝贝描述</td></tr> 
								<tr><td><textarea name="describ" maxlength="69" cols="140" rows="4" placeholder="宝贝描述最多可输入69个字符"></textarea></td></tr> 
								<div class="col-md-4 col-sm-6">
									<div class="portfolio-item">
										<div class="portfolio-image">
											<img src="" alt="靓照1" height="160px" id="img0">
										</div>
									</div>
									<input name="img[]" type="file" id="up0" onchange="viewmypic(showimg,this.form.up0);"/>
								</div> 
							</table>                      
							</p>
						</div>
						
						<!----详细信息 输入框--->
						<div class="panel-body">
							<table class="table">
								<tr>
									<td>详细信息</td>
								</tr> 
								<tr>
									<td>
										<textarea id="info-text" ip="__PUBLIC__/" name="htmltext" style="display:none"></textarea>
										<script id="editor" type="text/plain" class="form-default" style="width:100%">
										</script>	
									</td>
								</tr> 							
							</table>                      
						</div><!----详细信息 输入框--->						
					</div>
				</div>
			</div>
        </form>   
        </div>
        <div class="col-xs-1"></div> 
    </div>
</div>

	<script type="text/javascript">	
		   //实例化编辑器
			//建议使用工厂方法getEditor创建和引用编辑器实例，如果在某个闭包下引用该编辑器，直接调用UE.getEditor('editor')就能拿到相关的实例
			var um = UM.getEditor('editor');
			UM.getEditor('editor').setContent($("#info-text").val());
			$(".submit-btn").click(function(){
				
				var txt=UM.getEditor('editor').getContent();//获得描述内容
				//测试描述内容
				//var txt = '<p><img src=\"http://127.0.0.1:89/DIYBuy/app/Public/ueditor/php/upload/20141008/14127569472248.jpg\" _src=\"http://127.0.0.1:89/DIYBuy/app/Public/ueditor/php/upload/20141008/14127569472248.jpg\"/></p><p><img src=\"http://127.0.0.1:89/DIYBuy/app/Public/ueditor/php/upload/20141008/14127569585354.jpg\" _src=\"http://127.0.0.1:89/DIYBu"';   
				//var restr = /src\s*=\Shttp:\S{2,2}[\d]{1,3}.[\d]{1,3}.[\d]{1,3}.[\d]{1,3}:[\d]{0,4}\SDIYBuy\Sapp\SPublic\Sueditor\Sphp\Supload\S\w{0,}\S\w{0,}.jpg\"/g;    
				//匹配正则表达式
				//var ipStr = /<img src\s*=\Shttp:\S{2,2}[\d]{1,3}.[\d]{1,3}.[\d]{1,3}.[\d]{1,3}:[\d]{0,4}\SDIYBuy\Sapp\SPublic\S/g; 
				var ipStr = /<img src\s*=\S{1,}(http|https):\S{2,2}\S{1,}\SDIYBuy\Sapp\SPublic\S/g;
				//获取上传的路径
				var array=txt.match(ipStr);
				//alert(txt);
				//获取系统路径
				var path=$("#info-text").attr('ip');
				
				for(var i = 0 ;i<array.length;i++ ){
					//全文替换
					//alert("匹配的是:"+array[i]);
					txt = txt.replace(array[i],"<img src="+'"'+path);
					//alert("替换结果:"+txt);
				}
				$("#info-text").val(txt);
				//alert("最终结果："+$("#info-text").val());				
				$("#form").submit();
			});
			
			
	</script>

</body>
</html>
